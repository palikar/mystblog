<!DOCTYPE html>






































<html
  class="not-ready text-sm lg:text-base"
  style="--bg: #faf6f1"
  lang="en-us">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, shrink-to-fit=no"
  />

  
  <title>Github commits&#39; emails change - Stanislav Arnaudov</title>

  
  <meta name="theme-color" />
  
  <meta name="description" content="Abstract You know that Contributions panel on your Github profile page. Let&rsquo;s face it, developers these days take much pride when they can show their consistent work and progress of their own/forked repositories&hellip; even when some of their commits are nothing more than an implementation of a single function. Or of course, it may be just me with that pride ðŸ˜’. Said panel is a clear indication to your future employee or members of your &ldquo;coding community&rdquo; that you are pretty much a big deal with a good work ethic." />
  <meta
    name="author"
    content="[Stanislav Arnaudov]"
  />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="/main.min.css" />

  
  <script
    defer
    src="highlight.min.js"
    onload="hljs.initHighlightingOnLoad();"
  ></script>
  

  
   
  <link rel="preload" as="image" href="theme.png" />

  
  
  
  <link rel="preload" as="image" href="https://www.gravatar.com/avatar/6f49be4b1398e1936dd765ef2df3a6f2?s=160&amp;d=identicon" />
  
  

  
  <link rel="preload" as="image" href="github.svg" />
  
  <link rel="preload" as="image" href="linkedin.svg" />
  
  <link rel="preload" as="image" href="facebook.svg" />
  

  
  <link rel="icon" href="favicon.ico" />
  <link rel="apple-touch-icon" href="apple-touch-icon.png" />

  
  <meta name="generator" content="Hugo 0.110.0">

  
  

  
  
  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-158773896-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-158773896-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
  
  
  
  <meta property="og:title" content="Github commits&#39; emails change" />
<meta property="og:description" content="A short description of a solution to a Github related problem with the email addresses associated with a commit history" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/github_history_repair/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-06-22T00:00:00+02:00" />
<meta property="article:modified_time" content="2023-02-09T23:51:41+02:00" />

  
  <meta itemprop="name" content="Github commits&#39; emails change">
<meta itemprop="description" content="A short description of a solution to a Github related problem with the email addresses associated with a commit history"><meta itemprop="datePublished" content="2018-06-22T00:00:00+02:00" />
<meta itemprop="dateModified" content="2023-02-09T23:51:41+02:00" />
<meta itemprop="wordCount" content="1383">
<meta itemprop="keywords" content="" />
  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Github commits&#39; emails change"/>
<meta name="twitter:description" content="A short description of a solution to a Github related problem with the email addresses associated with a commit history"/>

  
  
</head>

  <body class="text-black duration-200 ease-out dark:text-white">
    <header class="mx-auto flex h-[5rem] max-w-3xl px-8 lg:justify-center">
  <div class="relative z-50 mr-auto flex items-center">

    <img alt="" src='/logos/SA.png' width="48" height="48"/>
    <a class="-translate-x-[1px] -translate-y-0.5 text-3xl font-bold ml-6" href="">
      Stanislav Arnaudov
    </a>

    <a class="btn-dark ml-6 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]">
    </a>
  </div>

  <a
    class="btn-menu relative z-50 -mr-8 flex h-[5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"
  ></a>

  
  <script>
    
    const htmlClass = document.documentElement.classList;
    setTimeout(() => {
      htmlClass.remove('not-ready');
    }, 10);

    
    const btnMenu = document.querySelector('.btn-menu');
    btnMenu.addEventListener('click', () => {
      htmlClass.toggle('open');
    });

    
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const lightBg = `"#faf6f1"`.replace(/"/g, '');
    const setDark = (isDark) => {
      metaTheme.setAttribute('content', isDark ? '#000' : lightBg);
      htmlClass[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark);
    };

    
    const darkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    if (htmlClass.contains('dark')) {
      setDark(true);
    } else {
      const darkVal = localStorage.getItem('dark');
      setDark(darkVal ? darkVal === 'true' : darkScheme.matches);
    }

    
    darkScheme.addEventListener('change', (event) => {
      setDark(event.matches);
    });

    
    const btnDark = document.querySelector('.btn-dark');
    btnDark.addEventListener('click', () => {
      setDark(localStorage.getItem('dark') !== 'true');
    });
  </script>

  <div
    class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"
  >
    
    
    <nav class="lg:ml-12 lg:flex lg:flex-row lg:items-center lg:space-x-6">
      
      <a
        class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal"
        href="/"
        >Home</a
      >
      
      <a
        class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal"
        href="/about/"
        >About</a
      >
      
      <a
        class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal"
        href="/projects"
        >Projects</a
      >
      
      <a
        class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal"
        href="/posts/"
        >Posts</a
      >
      
      <a
        class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal"
        href="/contact/"
        >Contact</a
      >
      
    </nav>
    

    
    <nav
      class="mt-12 flex justify-center space-x-10 dark:invert lg:mt-0 lg:ml-12 lg:items-center lg:space-x-6"
    >
      
      <a
        class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./github.svg)"
        href=" https://github.com/palikar "
        target="_blank"
      ></a>
      
      <a
        class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./linkedin.svg)"
        href=" https://linkedin.com/in/stanislav-arnaudov-37b475164 "
        target="_blank"
      ></a>
      
      <a
        class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./facebook.svg)"
        href=" https://facebook.com/stanislav.ts "
        target="_blank"
      ></a>
      
    </nav>
    
  </div>
</header>


    <main class="prose prose-neutral relative mx-auto min-h-[calc(100%-10rem)] max-w-3xl px-4 pt-20 pb-32 dark:prose-invert">
      

<article>
  <header class="mb-20">

    <h1 class="!my-0 pb-2.5">Github commits&#39; emails change</h1>

    
    <div class="text-sm opacity-60">
      
      <time>Jun 22, 2018</time>
      
      
      <span class="mx-1">&middot;</span>
      <span>[Stanislav Arnaudov]</span>
      <span class="mx-1">&middot;</span>
      <span>6 minute read</span>
      <span class="mx-1">&middot;</span>
      <span>1383 words</span>
      
    </div>
    
  </header>

  <section><h2 id="abstract">Abstract</h2>
<p>You know that <em>Contributions</em> panel on your <a href="http://github.com/">Github</a> profile page. Let&rsquo;s face it, developers these days take much pride when they can show their consistent work and progress of their own/forked repositories&hellip; even when some of their commits are nothing more than an implementation of a single function. Or of course, it may be just me with that pride ðŸ˜’. Said panel is a clear indication to your future employee or members of your &ldquo;coding community&rdquo; that you are pretty much a big deal with a good work ethic. Imagine in what of a situation you would be if for some random reason your commits didn&rsquo;t show up there. This post addresses the issue of not having a proper <em>git</em> configuration (<code>~/.gitconfig</code>) file on your system and commits to Github with the wrong email address.</p>
<h2 id="my-problem-with-github-and-some-contributions-in-limbo">My problem with GitHub and some contributions in limbo</h2>
<p>So, yeah, I had the problem myself. I was committing things regularly to my repositories on Github and but only a very small portion of my commits were showing in the <em>Contributions</em> panel. It took me a while to notice that and I was kinda freaked about it as I thought that my &ldquo;hard work&rdquo; will be forgotten and the future generations would not be able to see it. <br /> <br /> A little research (I literally just clicked on <a href="https://help.github.com/articles/why-are-my-contributions-not-showing-up-on-my-profile/">Learn how we count contributions</a>) on how Github counts contributions and I found out that the email address of the commits must match the main email of your Github account. Some other hints are taken from the Github page about how contributions are counted:</p>
<blockquote>
<p>Commits will appear on your contributions graph if they meet all of the following conditions:</p>
<p>-The email address used for the commits is associated with your GitHub account. -The commits were made in a standalone repository, not a fork. -The commits were made:</p>
<ul>
<li>In the repository&rsquo;s default branch (usually master)</li>
<li>In the <em>gh-pages</em> branch (for repositories with <a href="https://help.github.com/articles/user-organization-and-project-pages/#project-pages-sites">Project Pages</a> sites)</li>
</ul>
</blockquote>
<p>The thing that I found out was happening - I would cloned one of my repositories, do some work on it and then commit the work it and push it on Github. The email address for the commit, however, would be set to <code>arnaud@localhost.localdomain</code> which is some weird default configuration of Debian and most cetrantly not the address I want to use on Github. This makes it think that the commits aren&rsquo;t coming from me.</p>
<h2 id="proper-github-configuration">Proper github configuration</h2>
<p>In order to avoid the problem of the future, you have two options. You can set your name and email address manually for each repository you are working on. Just go in the repository&rsquo;s folder and set the <code>user.name</code> and <code>user.email</code> fields like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>git config user.name <span style="color:#e6db74">&#39;Stanislav Arnaudov&#39;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>git config user.emial <span style="color:#e6db74">&#39;email_adress@somewhere.org&#39;</span>
</span></span></code></pre></div><p>This sets the name and the email on a repository &ldquo;local&rdquo; level. After that, each commit will have this name and email address. If you want to set a global name and email address for your system and not worry about each individual repository, you would have to edit (create if you don&rsquo;t have it) your <code>~/.gitconfig</code> file. Somewhere in there, you should have something like</p>
<pre tabindex="0"><code class="language-conf" data-lang="conf">[user]
        name = Stanislav Arnaudov
        email = email_adress@somewhere.org
</code></pre><p>This sets the name and email globally and every commit made on your system will have the proper fields. <br /> <br /> On Github you can see the raw path of a commit with <code>https://github.com/&lt;user_name&gt;/&lt;repository&gt;/commit/&lt;commit_id&gt;.patch</code>. On this page, you could inspect the commit and see exactly which email address is associated with it.</p>
<h2 id="fixing-the-your-repositories">Fixing the your repositories</h2>
<p>But of course, so far we&rsquo;ve only prevented the problem of occurring in the future. You probably want to know how do we fix the previous &ldquo;damage&rdquo;. This section describes that and my approach to tackling it.</p>
<br />
<p>First, some of my experiments and findings. The thing about git repositories - everything is stored in that nifty <code>.git</code> folder. Every delta, every branch, every everything. So, I supposed that if I go there and start changing things, I could probably change the email address of past commits. If you run <em>grep</em> in your repository like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>grep -r <span style="color:#e6db74">&#34;arnaud@localhost.localdomain&#34;</span> ./.git
</span></span></code></pre></div><p>you get all the occurrences of your &ldquo;wrong&rdquo; email in your commits&hellip; or everywhere else for that matter. OK, so if you change those Github probably will notice and everything will be OK, right? So, I run <em><a href="https://en.wikipedia.org/wiki/Sed">sed</a></em> in conjunction with <em>find</em> like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>find ./.git/ -type f -exec sed <span style="color:#e6db74">&#39;s/arnaud@scc-wkit-clxa-23-139.scc.kit.edu/email_adress@somewhere.org/&#39;</span> -i <span style="color:#f92672">{}</span> +;
</span></span></code></pre></div><p>This finds every regular file in the <em>.git</em> folder and runs <code>sed 's/arnaud@localhost.localdomain/email_adress@somewhere.org/' -i</code> on it. With the expression in the quotation marks <em>sed</em> replaces everything that matches <code>arnaud@localhost.localdomain</code> with <code>email_adress@somewhere.org</code>. The <code>-i</code> means &ldquo;in place&rdquo; so be careful when running <em>sed</em> like that because you may break something. So I do that and then push onto Github, And nothing happened. The thing is <code>git push</code> the things &ldquo;in&rdquo; your repository and kinda is disregarding of changes in <code>.git</code>. In some cases, git may refuse to make the push, crying about &ldquo;histories don&rsquo;t match&rdquo; (or something). In those cases, one would have to call push as</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>git push --force
</span></span></code></pre></div><p>which overwrites &rsquo;everything&rsquo; in the Github repository. So I do that and&hellip;.again, this didn&rsquo;t work. When I expected the commits in the repository on Github my profile picture still wasn&rsquo;t there. I am not sure what the reason for that is although I was pretty sure I would change at least <em>something</em> while messing with the <em>.git</em> folder.</p>
<br />
<p>Here I will stop rambling and boring you with my &ldquo;personal experience&rdquo; and just give you the solution.</p>
<h3 id="the-right-solution">The right solution</h3>
<p>After some more research, I found <a href="https://help.github.com/articles/changing-author-info/">this help page</a> on Github. I guess the problem is not uncommon. The page describes the whole process of &ldquo;re-authoring&rdquo; your commit history. They even provide a script that could be run in a bare repository (one only for pushing and pulling from) that changes everything. Something to note - the provided script must be given old (wrong) and new (the right one) email to re-placed. This is done because while preforming the &ldquo;hack&rdquo; on a shared repo where not one but a few developers have commits. Of course, you don&rsquo;t really want to overwrite the email of someone else. <br /> <br /> BUT&hellip; in my repositories, I had commits also made from my university&rsquo;s network and the emails of those were completely other beasts. Therefore I change the script a little bit and wrote an extra supplementary script that does absolutely everything. If you want to automate the whole process, copy this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;Cloning repo...&#34;</span>
</span></span><span style="display:flex;"><span>git clone --bare $1 new_repo
</span></span><span style="display:flex;"><span>cd ./new_repo
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;Running reindex script...&#34;</span>
</span></span><span style="display:flex;"><span>git filter-branch --env-filter <span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">CORRECT_NAME=&#34;&lt;user name&gt;&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">CORRECT_EMAIL=&#34;&lt;user email&gt;&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export GIT_COMMITTER_NAME=&#34;$CORRECT_NAME&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export GIT_COMMITTER_EMAIL=&#34;$CORRECT_EMAIL&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export GIT_AUTHOR_NAME=&#34;$CORRECT_NAME&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export GIT_AUTHOR_EMAIL=&#34;$CORRECT_EMAIL&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span> --tag-name-filter cat -- --branches --tags
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;Hard-pushing to origin...&#34;</span>
</span></span><span style="display:flex;"><span>git config --global credential.helper cache
</span></span><span style="display:flex;"><span>git push --force --tags origin <span style="color:#e6db74">&#39;refs/heads/*&#39;</span>
</span></span><span style="display:flex;"><span>cd ..
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;Deleting folder...&#34;</span>
</span></span><span style="display:flex;"><span>rm -rf new_repo
</span></span></code></pre></div><p>in a <code>.sh</code> file, adjust the <code>&lt;user_name&gt;</code> and <code>&lt;user email&gt;</code> fields with your name and email and run the script like <code>./file.sh https://github/&lt;user&gt;/&lt;repo&gt;.git</code> This will:</p>
<ol>
<li>Clone the repo in a new folder with name new_repo</li>
<li>Run a slight modification of Github&rsquo;s script</li>
<li>Push the change repo on Github (eventually, you will be asked to give your username and password)</li>
<li>Deletes the newly created folder.</li>
</ol>
<p>In the end, everything is as it was but all of the commits in the repo will have the email that was in the script. <br /> <br /> <span class="underline">Note:</span> This will create a file in your home directory with name .git-credentials and it will contain your Github username and password. I do this so I can use <code>git config --global credential.helper cache</code> which removes the necessity of typing out your name and password on every commit. (Yes, I know, I should set up the <a href="https://help.github.com/en/articles/connecting-to-github-with-ssh">ssh thing</a>, shut up) <br /> <br /> <strong>Caution:</strong> My script changes the commiter&rsquo;s emails and names of <span class="underline"><strong>ALL</strong></span> commits. If you run the script on a repository with several developers, you could potentially and most likely will cause some people to be angry with you&hellip; and rightfully so! I mean, you just ruined someone&rsquo;s <em>Contributions</em> panel&hellip; how would you like that if done to you. <br /> <br /> And there you have it. With your newly acquired knowledge you could transform your <em>Contributions</em> panel form this: <img src="/ox-hugo/panel_bad.png" alt=""> to this. <img src="/ox-hugo/pane_good.png" alt=""> And you know, the ultimate bragging rights are yours!</p>
</section>

  
  


  
  
  <div id="disqus_thread"></div>

<script>

 function readCookie(name)
 {
   var nameEQ = name + "=";
   var ca = document.cookie.split(';');
   for(var i=0;i < ca.length;i++) {
     var c = ca[i];
     while (c.charAt(0)==' ') c = c.substring(1,c.length);
     if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
   }
   return null;
 }

 (function() {
   let cookieValue = readCookie('consent-settings');
   if (cookieValue)
   {
     var consentValue = cookieValue.toString();
     if (consentValue[1] === "1")
     {	    
       const disqusShortname = 'palikar-github-io';
       const script = document.createElement('script');
       script.src = 'https://' + disqusShortname + '.disqus.com/embed.js';
       script.setAttribute('data-timestamp', + new Date());
       document.head.appendChild(script);
     }
   }
 })();
 
</script>

  
</article>


    </main>

    <footer class="opaco mx-auto flex h-[5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60">
  <div class="mr-auto">
    &copy; 2023
    <a class="link" href="">Stanislav Arnaudov</a>
  </div>
  <a class="link mx-6" href="#cookies" onclick="document.getElementById('consent-notice').style.display = 'block'; ">Cookie Policy</a>
  <a class="link mx-6" href="https://gohugo.io/" rel="noopener" target="_blank">Powered by Hugo</a>
  Theme: 
  <a class="link" href="https://github.com/nanxiaobei/hugo-paper" rel="noopener" target="_blank" >Paper 6</a>
</footer>


    <style>
    #consent-notice {padding: 1rem 1rem; display: none; text-align: center; position: fixed; bottom: 0; width: calc(100% - 2rem); background: #222; color: white;}
    #consent-notice span {margin-right: 1rem;}
    #consent-notice button {cursor: pointer; display: inline-block; width: auto;}
    #consent-notice span a {color: white; text-decoration: underline; text-decoration-color: rgba(255,255,255,0.5);}
    #consent-notice button.btn {margin-left: 0.5rem;}
    #consent-notice button.btn.manage-consent {background: rgba(255,255,255,0.1); font-weight: normal;}
    
    #consent-overlay {position: fixed; left: 0; top: 0; width: 100%; height: 100vh; display: none; background: rgba(0,0,0,0.75); z-index: 999999; overflow: auto; cursor: pointer;}
    #consent-overlay.active {display: flex;}
    #consent-overlay > div {background: white; width: 100%; max-width: 30rem; padding: 1.75rem; margin: auto; cursor: initial;}
    #consent-overlay > div > div {display: flex; align-items: flex-start; margin-bottom: 1rem;}
    #consent-overlay > div > div:last-child {margin: 0;}
    #consent-overlay h3 {padding-top: 0;}
    #consent-overlay input {margin-top: 0.3rem;}
    #consent-overlay label {display: block; color: black; }
    #consent-overlay .btn {margin-right: 0.5rem;}
    #consent-overlay button.btn.save-consent {background: rgba(0,0,0,0.6); font-weight: normal;}

    @media (max-width: 767px) {
        #consent-overlay > div {padding: 1.75rem 1rem;}
        #consent-notice span {display: block; padding-top: 3px; margin-bottom: 1.5rem;}
        #consent-notice button.btn {position: relative; bottom: 4px;}
    }
</style>

<div id="consent-notice">
  <span>We would like to use <a class="manage-consent" href="#manage-consent">third party code</a> to improve the functionality of this website.</span>
  <span><a class="link mx-6" href="/cookies" onclick="document.getElementById('consent-notice').style.display = 'block'; ">More Information</a></span>
  <button class="btn manage-consent">Manage preferences</button>
  <button class="btn deny-consent">Deny</button>
  <button class="btn approve-consent">Allow</button>
</div>

<div id="consent-overlay">
    <div>
        
            <div>
                <input type="checkbox" id="item0" value="1" name="item0"  />
                <label for="item0">
                  <h3>Google Anaytics (functional)</h3>
		  <p>This code gives us insight into the number of people that visit our website, where they are from and what they are clicking on.</p>
                </label>
            </div>
        
            <div>
                <input type="checkbox" id="item1" value="1" name="item1"  />
                <label for="item1">
                  <h3>Disqus Comment service</h3>
		  <p>The code allows to use the Disqus service for comments on the posts</p>
                </label>
            </div>
        
        <div>
            <button id="save-consent" class="btn save-consent" data-consentvalue="00">Save preferences</button>
            <button class="btn approve-consent">Allow all</button>
        </div>
    </div>
</div>
<script>

    const scripts = [];
    scripts[ 0 ] = "/js/ga.js";
    scripts[ 1 ] = "/js/disqus.js";

    function createCookie(name,value,days) {
        var expires = "";
        if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days*24*60*60*1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + value + expires + "; path=/";
    }
    function readCookie(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
        for(var i=0;i < ca.length;i++) {
            var c = ca[i];
            while (c.charAt(0)==' ') c = c.substring(1,c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
        }
        return null;
    }
    function eraseCookie(name) {
        createCookie(name,"",-1);
    }
    function denyAllConsentScripts() {
        var consentValue = "";
        scripts.forEach(function(){
            consentValue = consentValue + "0";
        });
        acceptSomeConsentScripts(consentValue);
    }
    function acceptAllConsentScripts() {
        var consentValue = "";
        scripts.forEach(function(){
            consentValue = consentValue + "1";
        });
        acceptSomeConsentScripts(consentValue);
    }
    function acceptSomeConsentScripts(consentValue) {
        setConsentInputs(consentValue);
        createCookie('consent-settings',consentValue,31);
        document.getElementById('consent-notice').style.display = 'none';
        document.getElementById('consent-overlay').classList.remove('active');
        loadConsentScripts(consentValue);
    }
    function loadConsentScripts(consentValue) {
        scripts.forEach(function(value,key){
            
            if(consentValue[key]=="1") {
                var s = document.createElement('script');
                s.type = 'text/javascript';
                s.src = value;
                document.body.appendChild(s);
            }
        });
    }
    function setConsentInputs(consentValue) {
        var elements = document.querySelectorAll('#consent-overlay input:not([disabled])');
        elements.forEach(function(el,index) {
            if(consentValue[index]=="1") el.checked = true;
            else el.checked = false;
        });
    }
    function setConsentValue() {
        var elements = document.querySelectorAll('#consent-overlay input:not([disabled])');
        var consentValue = "";
        elements.forEach(function(el) {
            if(el.checked) consentValue = consentValue + "1";
            else consentValue = consentValue + "0";
        });
        document.getElementById("save-consent").dataset.consentvalue = consentValue;
    }
 
    var elements = document.querySelectorAll('#consent-overlay input:not([disabled])');
    elements.forEach(function(el) {
        el.checked = false;
    });

    if(readCookie('consent-settings')) {
        var consentValue = readCookie('consent-settings').toString();
        setConsentInputs(consentValue);
        loadConsentScripts(consentValue);
    } else {
      document.getElementById('consent-notice').style.display = 'block';
    }
 var elements = document.querySelectorAll('.manage-consent');
    elements.forEach(function(el) {
        el.addEventListener("click",function() {
            document.getElementById('consent-overlay').classList.toggle('active');
        });
    });
    var elements = document.querySelectorAll('.deny-consent');
    elements.forEach(function(el) {
        el.addEventListener("click",function() {
            denyAllConsentScripts();
        });
    });
    var elements = document.querySelectorAll('.approve-consent');
    elements.forEach(function(el) {
        el.addEventListener("click",function() {
          acceptAllConsentScripts();
        });
    });
    document.getElementById("save-consent").addEventListener("click",function() {
        setConsentValue();
        acceptSomeConsentScripts(this.dataset.consentvalue);
    });
    document.getElementById("consent-overlay").addEventListener("click",function(e) {
        if (!document.querySelector("#consent-overlay > div").contains(e.target)){
            this.classList.toggle('active');
        }
    });
</script>


    

    


  </body>
</html>
